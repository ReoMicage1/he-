<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–º–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #5e35b1;
            --accent-color: #7c4dff;
            --text-color: #f5f5f5;
            --bg-color: #121212;
            --card-color: rgba(30, 30, 46, 0.8);
            --border-color: rgba(124, 77, 255, 0.3);
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #533d7b);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-color);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            width: 95%;
            max-width: 1400px;
            height: 95vh;
            display: flex;
            flex-direction: column;
            background: var(--card-color);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }
        
        .header {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.2);
            text-align: center;
            font-size: 1.3rem;
            font-weight: 500;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        
        .header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
            opacity: 0.5;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .chat-section {
            width: 350px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }
        
        .chat-area {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
            position: relative;
            word-break: break-word;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            align-self: flex-end;
            background: var(--accent-color);
            border-bottom-right-radius: 5px;
            box-shadow: 0 2px 8px rgba(124, 77, 255, 0.3);
        }
        
        .assistant-message {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            align-self: flex-start;
            margin-bottom: 5px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        .input-area {
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            border-top: 1px solid var(--border-color);
            background: rgba(0, 0, 0, 0.1);
        }
        
        .input-container {
            width: 100%;
            display: flex;
            gap: 10px;
        }
        
        #textInput {
            flex: 1;
            padding: 12px 15px;
            border-radius: 24px;
            border: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            font-family: 'Roboto', sans-serif;
            outline: none;
            transition: all 0.3s;
        }
        
        #textInput:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(124, 77, 255, 0.2);
        }
        
        .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent-color);
            border: none;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(124, 77, 255, 0.3);
        }
        
        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(124, 77, 255, 0.4);
        }
        
        .mic-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--accent-color);
            border: none;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(124, 77, 255, 0.3);
        }
        
        .mic-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(124, 77, 255, 0.4);
        }
        
        .mic-btn.active {
            animation: pulse 1.5s infinite;
            background: #ff3d71;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 61, 113, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255, 61, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 61, 113, 0); }
        }
        
        .waves {
            display: none;
            gap: 4px;
            height: 32px;
            align-items: flex-end;
        }
        
        .wave {
            width: 5px;
            height: 10px;
            background: var(--accent-color);
            border-radius: 3px;
            animation: wave 1.5s infinite ease-in-out;
        }
        
        .wave:nth-child(1) { animation-delay: 0.1s; }
        .wave:nth-child(2) { animation-delay: 0.3s; }
        .wave:nth-child(3) { animation-delay: 0.5s; }
        .wave:nth-child(4) { animation-delay: 0.7s; }
        .wave:nth-child(5) { animation-delay: 0.9s; }
        
        @keyframes wave {
            0%, 100% { height: 10px; }
            50% { height: 25px; }
        }
        
        .multi-window-section {
            flex: 1;
            display: flex;
            position: relative;
        }
        
        .main-window {
            flex: 0.7;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }
        
        .secondary-windows {
            flex: 0.3;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .window {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        
        .window-header {
            font-weight: 500;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-item, .folder-item {
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-item:hover, .folder-item:hover {
            background: rgba(124, 77, 255, 0.2);
            transform: translateX(5px);
        }
        
        .folder-contents {
            margin-left: 20px;
            display: none;
        }
        
        .folder-contents.expanded {
            display: block;
        }
        
        .folder-toggle {
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .folder-toggle.expanded {
            transform: rotate(90deg);
        }
        
        .notes-area {
            height: 200px;
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            font-family: 'Roboto', sans-serif;
            resize: none;
            outline: none;
        }
        
        .notes-save-btn {
            margin-top: 10px;
            padding: 8px 15px;
            background: var(--accent-color);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .notes-save-btn:hover {
            background: #7c4dff;
            transform: translateY(-2px);
        }
        
        .back-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .back-btn:hover {
            background: rgba(255, 61, 113, 0.3);
        }
        
        .clear-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .clear-btn:hover {
            background: rgba(255, 61, 113, 0.3);
        }
        
        .file-explorer {
            display: none;
        }
        
        .notes-explorer {
            display: none;
        }
        
        .entertainment-explorer {
            display: none;
        }
        
        .settings-explorer {
            display: none;
        }
        
        .active-window {
            display: block;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        .file-action-btn {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
            text-align: center;
        }
        
        .file-action-btn:hover {
            background: var(--accent-color);
            transform: translateY(-2px);
        }
        
        .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 5px;
            padding: 30px;
            text-align: center;
            margin: 15px 0;
            cursor: pointer;
            font-size: 1.1rem;
        }
        
        .drop-zone.highlight {
            border-color: var(--accent-color);
            background: rgba(124, 77, 255, 0.1);
        }
        
        .file-preview {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            display: none;
        }
        
        .file-preview.active {
            display: block;
        }
        
        .file-preview-content {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .setting-item {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-label {
            display: block;
            margin-bottom: 5px;
            flex: 1;
        }
        
        .setting-control {
            width: 100%;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            color: var(--text-color);
        }
        
        .setting-icon {
            width: 24px;
            text-align: center;
            color: var(--accent-color);
        }
        
        .recommendations {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        
        .recommendation-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }
        
        .recommendation-item:hover {
            color: var(--accent-color);
        }
        
        .chat-tabs {
            display: flex;
            padding: 10px;
            background: rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid var(--border-color);
            gap: 5px;
            overflow-x: auto;
        }
        
        .chat-tab {
            padding: 5px 10px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            font-size: 0.8rem;
            white-space: nowrap;
            position: relative;
        }
        
        .chat-tab.active {
            background: var(--accent-color);
        }
        
        .chat-tab-close {
            margin-left: 5px;
            cursor: pointer;
            font-size: 0.7rem;
        }
        
        .new-chat-btn {
            padding: 5px 10px;
            border-radius: 15px;
            background: rgba(124, 77, 255, 0.3);
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .new-chat-btn:hover {
            background: rgba(124, 77, 255, 0.5);
        }
        
        .noise-suppression-indicator {
            position: absolute;
            top: 10px;
            right: 80px;
            font-size: 0.8rem;
            background: rgba(0, 200, 0, 0.2);
            padding: 3px 8px;
            border-radius: 15px;
            display: none;
        }
        
        .mouse-pointer {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: rgba(124, 77, 255, 0.7);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            display: none;
        }
        
        .mouse-click-effect {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 2px solid rgba(124, 77, 255, 0.8);
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998;
            display: none;
        }
        
        .offline-game {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #121212;
            z-index: 10000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .game-container {
            width: 600px;
            height: 200px;
            position: relative;
            overflow: hidden;
            border: 2px solid var(--accent-color);
            background-color: var(--bg-color);
        }
        
        .game-character {
            position: absolute;
            width: 60px;
            height: 60px;
            bottom: 0;
            left: 50px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path d="M30,10 Q40,0 50,10 L55,25 Q60,35 50,40 L45,50 Q40,60 30,55 Q20,60 15,50 L10,40 Q0,35 5,25 L10,10 Q20,0 30,10" fill="%237c4dff"/><circle cx="25" cy="25" r="3" fill="%23fff"/><circle cx="35" cy="25" r="3" fill="%23fff"/><path d="M25,35 Q30,40 35,35" stroke="%23fff" stroke-width="2" fill="none"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            transition: transform 0.1s;
        }
        
        .game-obstacle {
            position: absolute;
            width: 30px;
            height: 50px;
            bottom: 0;
            right: 0;
            background-color: #ff3d71;
            border-radius: 5px;
        }
        
        .game-ground {
            position: absolute;
            width: 100%;
            height: 10px;
            bottom: 0;
            background-color: var(--text-color);
        }
        
        .game-score {
            color: var(--text-color);
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        .game-instructions {
            color: var(--text-color);
            margin-top: 20px;
            text-align: center;
        }
        
        .game-menu {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .game-btn {
            padding: 12px 20px;
            background: var(--accent-color);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .game-btn:hover {
            background: #7c4dff;
            transform: translateY(-3px);
        }
        
        .play-again-btn {
            margin-top: 15px;
            padding: 10px 15px;
            background: var(--accent-color);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .play-again-btn:hover {
            background: #7c4dff;
            transform: translateY(-2px);
        }
        
        .snake-game {
            width: 400px;
            height: 400px;
            border: 2px solid var(--accent-color);
            position: relative;
            background-color: var(--bg-color);
        }
        
        .snake-segment {
            width: 20px;
            height: 20px;
            background-color: var(--accent-color);
            position: absolute;
            border-radius: 3px;
        }
        
        .snake-food {
            width: 20px;
            height: 20px;
            background-color: #ff3d71;
            position: absolute;
            border-radius: 50%;
        }
        
        .tetris-game {
            width: 200px;
            height: 400px;
            border: 2px solid var(--accent-color);
            position: relative;
            background-color: var(--bg-color);
        }
        
        .tetris-block {
            width: 20px;
            height: 20px;
            position: absolute;
            background-color: var(--accent-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }
        
        .sand-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background-color: #f5d76e;
            border-radius: 50%;
            pointer-events: none;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .chat-section {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .multi-window-section {
                flex-direction: column;
                height: 400px;
            }
            
            .main-window, .secondary-windows {
                width: 100%;
            }
            
            .game-container, .snake-game, .tetris-game {
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            –£–º–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫
            <button class="clear-btn" id="clearBtn">–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
            <div class="noise-suppression-indicator" id="noiseSuppressionIndicator">
                <i class="fas fa-microphone-slash"></i> –®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ
            </div>
        </div>
        
        <div class="main-content">
            <div class="chat-section">
                <div class="chat-tabs" id="chatTabs">
                    <div class="new-chat-btn" id="newChatBtn">
                        <i class="fas fa-plus"></i> –ù–æ–≤—ã–π —á–∞—Ç
                    </div>
                </div>
                
                <div class="chat-area" id="chatArea">
                </div>
                
                <div class="input-area">
                    <div class="input-container">
                        <input type="text" id="textInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å...">
                        <button class="send-btn" id="sendBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="waves" id="waves">
                        <div class="wave"></div>
                        <div class="wave"></div>
                        <div class="wave"></div>
                        <div class="wave"></div>
                        <div class="wave"></div>
                    </div>
                    
                    <button class="mic-btn" id="micBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="multi-window-section">
                <div class="main-window">
                    <div class="window" id="mainWindow">
                        <div class="window-header"><i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ</div>
                        <div id="mainContent"></div>
                        <div class="recommendations" id="recommendations">
                            <div class="window-header"><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</div>
                            <div id="recommendationsList"></div>
                        </div>
                    </div>
                </div>
                
                <div class="secondary-windows">
                    <div class="window file-explorer" id="fileExplorer">
                        <div class="window-header"><i class="fas fa-folder"></i> –§–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏</div>
                        <div class="drop-zone" id="dropZone">
                            –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –ø–∞–ø–∫–∏ —Å—é–¥–∞ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–∞
                        </div>
                        <div id="fileExplorerContent"></div>
                        <div class="file-actions">
                            <button class="file-action-btn" id="openInExplorerBtn"><i class="fas fa-folder-open"></i> –û—Ç–∫—Ä—ã—Ç—å</button>
                            <button class="file-action-btn" id="deleteFileBtn"><i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å</button>
                            <button class="file-action-btn" id="renameFileBtn"><i class="fas fa-edit"></i> –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>
                            <button class="file-action-btn" id="browseFilesBtn"><i class="fas fa-folder"></i> –ü—Ä–æ–≤–æ–¥–Ω–∏–∫</button>
                            <button class="file-action-btn" id="refreshFilesBtn"><i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏—Ç—å</button>
                        </div>
                        <div class="file-preview" id="filePreview">
                            <div class="window-header"><i class="fas fa-file-alt"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞</div>
                            <div class="file-preview-content" id="filePreviewContent"></div>
                        </div>
                    </div>
                    
                    <div class="window notes-explorer" id="notesExplorer">
                        <div class="window-header"><i class="fas fa-sticky-note"></i> –ó–∞–º–µ—Ç–∫–∏</div>
                        <textarea class="notes-area" id="notesArea" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏ –∑–¥–µ—Å—å..."></textarea>
                        <button class="notes-save-btn" id="notesSaveBtn"><i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                    
                    <div class="window entertainment-explorer" id="entertainmentExplorer">
                        <div class="window-header"><i class="fas fa-gamepad"></i> –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</div>
                        <div class="game-menu">
                            <button class="game-btn" id="dinoGameBtn">–î–∏–Ω–æ–∑–∞–≤—Ä–∏–∫</button>
                            <button class="game-btn" id="snakeGameBtn">–ó–º–µ–π–∫–∞</button>
                            <button class="game-btn" id="tetrisGameBtn">–¢–µ—Ç—Ä–∏—Å</button>
                            <button class="game-btn" id="guessMelodyBtn">–£–≥–∞–¥–∞–π –º–µ–ª–æ–¥–∏—é</button>
                            <button class="game-btn" id="fortuneBtn">–ü–æ–≥–∞–¥–∞—Ç—å</button>
                            <button class="game-btn" id="toastBtn">–ù–∞–π—Ç–∏ —Ç–æ—Å—Ç</button>
                            <button class="game-btn" id="poemBtn">–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ç–∏—Ö</button>
                        </div>
                    </div>
                    
                    <div class="window settings-explorer" id="settingsExplorer">
                        <div class="window-header"><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                        <div class="setting-item">
                            <div class="setting-icon"><i class="fas fa-volume-up"></i></div>
                            <div class="setting-label">
                                <label>–ì—Ä–æ–º–∫–æ—Å—Ç—å –≥–æ–ª–æ—Å–∞:</label>
                                <input type="range" class="setting-control" id="volumeControl" min="0" max="1" step="0.1">
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-icon"><i class="fas fa-tachometer-alt"></i></div>
                            <div class="setting-label">
                                <label>–°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏:</label>
                                <input type="range" class="setting-control" id="rateControl" min="0.5" max="2" step="0.1" value="1">
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-icon"><i class="fas fa-moon"></i></div>
                            <div class="setting-label">
                                <label>–¢–µ–º–Ω–∞—è —Ç–µ–º–∞:</label>
                                <input type="checkbox" class="setting-control" id="themeControl" checked>
                            </div>
                        </div>
                        <div class="setting-item">
                            <div class="setting-icon"><i class="fas fa-microphone-slash"></i></div>
                            <div class="setting-label">
                                <label>–®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ:</label>
                                <input type="checkbox" class="setting-control" id="noiseSuppressionControl">
                            </div>
                        </div>
                        <button class="notes-save-btn" id="saveSettingsBtn"><i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </div>
                    
                    <button class="back-btn" id="backBtn">–ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </div>
    </div>

    <div class="mouse-pointer" id="mousePointer"></div>
    <div class="mouse-click-effect" id="mouseClickEffect"></div>
    
    <div class="offline-game" id="offlineGame">
        <div class="game-score" id="gameScore">–°—á–µ—Ç: 0</div>
        <div class="game-container" id="gameContainer">
            <div class="game-character" id="gameCharacter"></div>
            <div class="game-ground"></div>
        </div>
        <div class="game-instructions">
            –ù–∞–∂–º–∏—Ç–µ –ü–†–û–ë–ï–õ, —á—Ç–æ–±—ã –ø—Ä—ã–≥–Ω—É—Ç—å<br>
            –ò–≥—Ä–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, –µ—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω–µ—Ç–µ—Å—å —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ–º
        </div>
        <button class="game-btn" id="backToMenuBtn">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
        <button class="play-again-btn" id="playAgainBtn">–ï—â–µ —Ä–∞–∑</button>
    </div>

    <div class="offline-game" id="snakeGame" style="display: none;">
        <div class="game-score" id="snakeScore">–°—á–µ—Ç: 0</div>
        <div class="snake-game" id="snakeGameContainer"></div>
        <div class="game-instructions">
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–º–µ–π–∫–æ–π<br>
            –°–æ–±–µ—Ä–∏—Ç–µ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –µ–¥—ã
        </div>
        <button class="game-btn" id="backToMenuBtnSnake">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
        <button class="play-again-btn" id="playAgainBtnSnake">–ï—â–µ —Ä–∞–∑</button>
    </div>

    <div class="offline-game" id="tetrisGame" style="display: none;">
        <div class="game-score" id="tetrisScore">–°—á–µ—Ç: 0</div>
        <div class="tetris-game" id="tetrisGameContainer"></div>
        <div class="game-instructions">
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–≥—É—Ä–∞–º–∏<br>
            –°–æ–±–µ—Ä–∏—Ç–µ –ª–∏–Ω–∏–∏, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –æ—á–∫–∏
        </div>
        <button class="game-btn" id="backToMenuBtnTetris">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
        <button class="play-again-btn" id="playAgainBtnTetris">–ï—â–µ —Ä–∞–∑</button>
    </div>

    <script>
        const chatArea = document.getElementById('chatArea');
        const micBtn = document.getElementById('micBtn');
        const waves = document.getElementById('waves');
        const textInput = document.getElementById('textInput');
        const sendBtn = document.getElementById('sendBtn');
        const clearBtn = document.getElementById('clearBtn');
        const backBtn = document.getElementById('backBtn');
        const fileExplorer = document.getElementById('fileExplorer');
        const fileExplorerContent = document.getElementById('fileExplorerContent');
        const notesExplorer = document.getElementById('notesExplorer');
        const notesArea = document.getElementById('notesArea');
        const notesSaveBtn = document.getElementById('notesSaveBtn');
        const entertainmentExplorer = document.getElementById('entertainmentExplorer');
        const settingsExplorer = document.getElementById('settingsExplorer');
        const openInExplorerBtn = document.getElementById('openInExplorerBtn');
        const deleteFileBtn = document.getElementById('deleteFileBtn');
        const renameFileBtn = document.getElementById('renameFileBtn');
        const browseFilesBtn = document.getElementById('browseFilesBtn');
        const refreshFilesBtn = document.getElementById('refreshFilesBtn');
        const guessMelodyBtn = document.getElementById('guessMelodyBtn');
        const fortuneBtn = document.getElementById('fortuneBtn');
        const toastBtn = document.getElementById('toastBtn');
        const poemBtn = document.getElementById('poemBtn');
        const dropZone = document.getElementById('dropZone');
        const volumeControl = document.getElementById('volumeControl');
        const rateControl = document.getElementById('rateControl');
        const themeControl = document.getElementById('themeControl');
        const noiseSuppressionControl = document.getElementById('noiseSuppressionControl');
        const noiseSuppressionIndicator = document.getElementById('noiseSuppressionIndicator');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const filePreview = document.getElementById('filePreview');
        const filePreviewContent = document.getElementById('filePreviewContent');
        const mainContent = document.getElementById('mainContent');
        const recommendationsList = document.getElementById('recommendationsList');
        const chatTabs = document.getElementById('chatTabs');
        const newChatBtn = document.getElementById('newChatBtn');
        const mousePointer = document.getElementById('mousePointer');
        const mouseClickEffect = document.getElementById('mouseClickEffect');
        const offlineGame = document.getElementById('offlineGame');
        const gameContainer = document.getElementById('gameContainer');
        const gameCharacter = document.getElementById('gameCharacter');
        const gameScore = document.getElementById('gameScore');
        const backToMenuBtn = document.getElementById('backToMenuBtn');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const dinoGameBtn = document.getElementById('dinoGameBtn');
        const snakeGameBtn = document.getElementById('snakeGameBtn');
        const tetrisGameBtn = document.getElementById('tetrisGameBtn');
        const snakeGame = document.getElementById('snakeGame');
        const snakeGameContainer = document.getElementById('snakeGameContainer');
        const snakeScore = document.getElementById('snakeScore');
        const backToMenuBtnSnake = document.getElementById('backToMenuBtnSnake');
        const playAgainBtnSnake = document.getElementById('playAgainBtnSnake');
        const tetrisGame = document.getElementById('tetrisGame');
        const tetrisGameContainer = document.getElementById('tetrisGameContainer');
        const tetrisScore = document.getElementById('tetrisScore');
        const backToMenuBtnTetris = document.getElementById('backToMenuBtnTetris');
        const playAgainBtnTetris = document.getElementById('playAgainBtnTetris');
        
        let isListening = false;
        let isAssistantSpeaking = false;
        let recognition;
        let typingInterval;
        let isTyping = false;
        let conversationHistory = [];
        let inactivityTimer;
        let currentWindow = null;
        let selectedFile = null;
        let fileHandles = new Map();
        let lastSpokenMessage = '';
        let recentFiles = [];
        let activeChatId = 'default';
        let chats = {
            'default': {
                history: [],
                notes: ''
            }
        };
        let noiseSuppressionEnabled = false;
        let mouseControlActive = false;
        let mouseX = window.innerWidth / 2;
        let mouseY = window.innerHeight / 2;
        let isGameRunning = false;
        let gameScoreValue = 0;
        let gameSpeed = 5;
        let isJumping = false;
        let jumpHeight = 0;
        let obstaclePosition = 600;
        let obstacleInterval;
        let isLightModeActive = false;
        let lightModeTimeout;
        let snake = [];
        let food = {};
        let direction = 'right';
        let snakeGameInterval;
        let snakeScoreValue = 0;
        let tetrisGrid = Array(20).fill().map(() => Array(10).fill(0));
        let currentTetrisPiece = null;
        let tetrisScoreValue = 0;
        let tetrisGameInterval;
        let sandParticles = [];
        const OPENAI_API_KEY = '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';
        
        const poems = [
            "–Ø –ø–æ–º–Ω—é —á—É–¥–Ω–æ–µ –º–≥–Ω–æ–≤–µ–Ω—å–µ...",
            "–õ—é–±–ª—é –≥—Ä–æ–∑—É –≤ –Ω–∞—á–∞–ª–µ –º–∞—è...",
            "–ë–µ–ª–µ–µ—Ç –ø–∞—Ä—É—Å –æ–¥–∏–Ω–æ–∫–∏–π...",
            "–£ –ª—É–∫–æ–º–æ—Ä—å—è –¥—É–± –∑–µ–ª–µ–Ω—ã–π..."
        ];
        
        const toasts = [
            "–ó–∞ –≤–∞—à–µ –∑–¥–æ—Ä–æ–≤—å–µ –∏ —Å—á–∞—Å—Ç—å–µ!",
            "–ü—É—Å—Ç—å —É–¥–∞—á–∞ –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç —Å –≤–∞–º–∏!",
            "–ó–∞ –ª—é–±–æ–≤—å, –¥—Ä—É–∂–±—É –∏ –≤–∑–∞–∏–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏–µ!",
            "–ü—É—Å—Ç—å —Å–±—É–¥—É—Ç—Å—è –≤—Å–µ –≤–∞—à–∏ –º–µ—á—Ç—ã!"
        ];
        
        const fortunes = [
            "–í–∞—Å –∂–¥–µ—Ç –ø—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ",
            "–ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö",
            "–í—Å—Ç—Ä–µ—á–∞ —Å —Å—Ç–∞—Ä—ã–º –¥—Ä—É–≥–æ–º –∏–∑–º–µ–Ω–∏—Ç –≤–∞—à—É –∂–∏–∑–Ω—å",
            "–£–¥–∞—á–∞ –Ω–∞ –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ, –¥–µ–π—Å—Ç–≤—É–π—Ç–µ —Å–º–µ–ª–æ"
        ];
        
        const fileIcons = {
            'txt': 'üìÑ', 'doc': 'üìÑ', 'docx': 'üìÑ', 'rtf': 'üìÑ', 'pdf': 'üìï', 'wpd': 'üìÑ',
            'ppt': 'üìä', 'pptx': 'üìä', 'xls': 'üìä', 'xlsx': 'üìä', 'csv': 'üìä',
            'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'gif': 'üñºÔ∏è', 'heif': 'üñºÔ∏è', 'webp': 'üñºÔ∏è',
            'aac': 'üéµ', 'mp3': 'üéµ', 'wav': 'üéµ', 'ogg': 'üéµ', 'flac': 'üéµ',
            'amv': 'üé¨', 'mpeg': 'üé¨', 'flv': 'üé¨', 'avi': 'üé¨', 'mp4': 'üé¨', 'mov': 'üé¨',
            'c': 'üíª', 'java': 'üíª', 'py': 'üíª', 'js': 'üíª', 'cpp': 'üíª', 'html': 'üåê', 'css': 'üåê',
            'iso': 'üóÑÔ∏è', 'rar': 'üóÑÔ∏è', 'tar': 'üóÑÔ∏è', '7z': 'üóÑÔ∏è', 'zip': 'üóÑÔ∏è',
            'exe': '‚öôÔ∏è', 'msi': '‚öôÔ∏è', 'bat': '‚öôÔ∏è', 'lnk': 'üîó'
        };
        
        const fileTypes = {
            'txt': '—Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª', 'doc': '–¥–æ–∫—É–º–µ–Ω—Ç Word', 'docx': '–¥–æ–∫—É–º–µ–Ω—Ç Word', 
            'rtf': '—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç', 'pdf': 'PDF –¥–æ–∫—É–º–µ–Ω—Ç', 'wpd': '–¥–æ–∫—É–º–µ–Ω—Ç WordPerfect',
            'ppt': '–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è PowerPoint', 'pptx': '–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è PowerPoint', 
            'xls': '—Ç–∞–±–ª–∏—Ü–∞ Excel', 'xlsx': '—Ç–∞–±–ª–∏—Ü–∞ Excel', 'csv': '—Ç–∞–±–ª–∏—Ü–∞ CSV',
            'jpg': '–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ JPEG', 'jpeg': '–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ JPEG', 'png': '–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ PNG', 
            'gif': '–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ GIF', 'heif': '–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ HEIF', 'webp': '–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ WebP',
            'aac': '–∞—É–¥–∏–æ —Ñ–∞–π–ª', 'mp3': '–∞—É–¥–∏–æ —Ñ–∞–π–ª', 'wav': '–∞—É–¥–∏–æ —Ñ–∞–π–ª', 
            'ogg': '–∞—É–¥–∏–æ —Ñ–∞–π–ª', 'flac': '–∞—É–¥–∏–æ —Ñ–∞–π–ª',
            'amv': '–≤–∏–¥–µ–æ —Ñ–∞–π–ª', 'mpeg': '–≤–∏–¥–µ–æ —Ñ–∞–π–ª', 'flv': '–≤–∏–¥–µ–æ —Ñ–∞–π–ª', 
            'avi': '–≤–∏–¥–µ–æ —Ñ–∞–π–ª', 'mp4': '–≤–∏–¥–µ–æ —Ñ–∞–π–ª', 'mov': '–≤–∏–¥–µ–æ —Ñ–∞–π–ª',
            'c': '–∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ C', 'java': '–∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ Java', 'py': '–∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ Python', 
            'js': '–∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ JavaScript', 'cpp': '–∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ C++', 
            'html': '–≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞', 'css': '—Å—Ç–∏–ª–∏ CSS',
            'iso': '–æ–±—Ä–∞–∑ –¥–∏—Å–∫–∞', 'rar': '–∞—Ä—Ö–∏–≤ RAR', 'tar': '–∞—Ä—Ö–∏–≤ TAR', 
            '7z': '–∞—Ä—Ö–∏–≤ 7z', 'zip': '–∞—Ä—Ö–∏–≤ ZIP',
            'exe': '–∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª', 'msi': '—É—Å—Ç–∞–Ω–æ–≤—â–∏–∫', 'bat': '–ø–∞–∫–µ—Ç–Ω—ã–π —Ñ–∞–π–ª', 
            'lnk': '—è—Ä–ª—ã–∫'
        };
        
        const tetrisPieces = [
            [[1, 1, 1, 1]], // I
            [[1, 1], [1, 1]], // O
            [[1, 1, 1], [0, 1, 0]], // T
            [[1, 1, 1], [1, 0, 0]], // L
            [[1, 1, 1], [0, 0, 1]], // J
            [[0, 1, 1], [1, 1, 0]], // S
            [[1, 1, 0], [0, 1, 1]]  // Z
        ];
        
        function initApp() {
            initVoiceRecognition();
            setupEventListeners();
            loadAllData();
            startInactivityTimer();
            checkInternetConnection();
            
            openFileExplorer();
            renderChatTabs();
            
            if (chats[activeChatId].history.length === 0) {
                setTimeout(() => {
                    const welcomeMessage = '–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à —É–º–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫. –î–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º –∏ –ø–∞–ø–∫–∞–º —É–∂–µ –æ—Ç–∫—Ä—ã—Ç. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Ö –∑–¥–µ—Å—å –∏–ª–∏ —Å–∫–∞–∑–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–∞–ø–∫–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è. –°–∫–∞–∂–∏—Ç–µ "–ª–∞–π—Ç" –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.';
                    addMessage('assistant', welcomeMessage, true);
                    speak(welcomeMessage);
                }, 1000);
            }
            
            document.addEventListener('keydown', handleHotkeys);
        }
        
        function checkInternetConnection() {
            if (!navigator.onLine) {
                startOfflineGame();
            }
            
            window.addEventListener('online', () => {
                offlineGame.style.display = 'none';
                snakeGame.style.display = 'none';
                tetrisGame.style.display = 'none';
                isGameRunning = false;
                clearInterval(obstacleInterval);
                clearInterval(snakeGameInterval);
                clearInterval(tetrisGameInterval);
            });
            
            window.addEventListener('offline', startOfflineGame);
        }
        
        function startOfflineGame() {
            offlineGame.style.display = 'flex';
            snakeGame.style.display = 'none';
            tetrisGame.style.display = 'none';
            isGameRunning = true;
            gameScoreValue = 0;
            gameScore.textContent = '–°—á–µ—Ç: 0';
            gameCharacter.style.bottom = '0';
            obstaclePosition = 600;
            
            const obstacles = document.querySelectorAll('.game-obstacle');
            obstacles.forEach(obstacle => obstacle.remove());
            
            obstacleInterval = setInterval(updateGame, 20);
        }
        
        function startSnakeGame() {
            offlineGame.style.display = 'none';
            snakeGame.style.display = 'flex';
            tetrisGame.style.display = 'none';
            isGameRunning = true;
            snakeScoreValue = 0;
            snakeScore.textContent = '–°—á–µ—Ç: 0';
            
            snake = [
                {x: 200, y: 200},
                {x: 180, y: 200},
                {x: 160, y: 200}
            ];
            
            direction = 'right';
            spawnFood();
            
            snakeGameContainer.innerHTML = '';
            renderSnake();
            renderFood();
            
            clearInterval(snakeGameInterval);
            snakeGameInterval = setInterval(updateSnakeGame, 150);
        }
        
        function startTetrisGame() {
            offlineGame.style.display = 'none';
            snakeGame.style.display = 'none';
            tetrisGame.style.display = 'flex';
            isGameRunning = true;
            tetrisScoreValue = 0;
            tetrisScore.textContent = '–°—á–µ—Ç: 0';
            
            tetrisGrid = Array(20).fill().map(() => Array(10).fill(0));
            spawnTetrisPiece();
            
            tetrisGameContainer.innerHTML = '';
            renderTetris();
            
            clearInterval(tetrisGameInterval);
            tetrisGameInterval = setInterval(updateTetrisGame, 500);
        }
        
        function spawnTetrisPiece() {
            const randomPiece = tetrisPieces[Math.floor(Math.random() * tetrisPieces.length)];
            currentTetrisPiece = {
                shape: randomPiece,
                x: 4,
                y: 0
            };
        }
        
        function updateTetrisGame() {
            if (!currentTetrisPiece) return;
            
            if (checkTetrisCollision(currentTetrisPiece.x, currentTetrisPiece.y + 1, currentTetrisPiece.shape)) {
                mergePieceToGrid();
                clearLines();
                spawnTetrisPiece();
                
                if (checkTetrisCollision(currentTetrisPiece.x, currentTetrisPiece.y, currentTetrisPiece.shape)) {
                    gameOver();
                    return;
                }
            } else {
                currentTetrisPiece.y++;
            }
            
            renderTetris();
        }
        
        function mergePieceToGrid() {
            for (let y = 0; y < currentTetrisPiece.shape.length; y++) {
                for (let x = 0; x < currentTetrisPiece.shape[y].length; x++) {
                    if (currentTetrisPiece.shape[y][x]) {
                        tetrisGrid[currentTetrisPiece.y + y][currentTetrisPiece.x + x] = 1;
                        createSandParticles(currentTetrisPiece.x + x, currentTetrisPiece.y + y);
                    }
                }
            }
        }
        
        function createSandParticles(gridX, gridY) {
            const x = gridX * 20;
            const y = gridY * 20;
            
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.className = 'sand-particle';
                particle.style.left = `${x + Math.random() * 20}px`;
                particle.style.top = `${y + Math.random() * 20}px`;
                tetrisGameContainer.appendChild(particle);
                
                const angle = Math.random() * Math.PI * 2;
                const speed = 1 + Math.random() * 3;
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                
                sandParticles.push({
                    element: particle,
                    x: parseFloat(particle.style.left),
                    y: parseFloat(particle.style.top),
                    vx: vx,
                    vy: vy,
                    life: 100 + Math.random() * 100
                });
            }
        }
        
        function updateSandParticles() {
            for (let i = sandParticles.length - 1; i >= 0; i--) {
                const p = sandParticles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.1; // gravity
                p.life--;
                
                p.element.style.left = `${p.x}px`;
                p.element.style.top = `${p.y}px`;
                p.element.style.opacity = p.life / 100;
                
                if (p.life <= 0) {
                    p.element.remove();
                    sandParticles.splice(i, 1);
                }
            }
        }
        
        function clearLines() {
            let linesCleared = 0;
            
            for (let y = tetrisGrid.length - 1; y >= 0; y--) {
                if (tetrisGrid[y].every(cell => cell === 1)) {
                    // Create sand particles for the cleared line
                    for (let x = 0; x < 10; x++) {
                        createSandParticles(x, y);
                    }
                    
                    tetrisGrid.splice(y, 1);
                    tetrisGrid.unshift(Array(10).fill(0));
                    linesCleared++;
                    y++;
                }
            }
            
            if (linesCleared > 0) {
                tetrisScoreValue += linesCleared * 100;
                tetrisScore.textContent = `–°—á–µ—Ç: ${tetrisScoreValue}`;
            }
        }
        
        function checkTetrisCollision(x, y, shape) {
            for (let row = 0; row < shape.length; row++) {
                for (let col = 0; col < shape[row].length; col++) {
                    if (shape[row][col]) {
                        const newX = x + col;
                        const newY = y + row;
                        
                        if (newX < 0 || newX >= 10 || newY >= 20) {
                            return true;
                        }
                        
                        if (newY >= 0 && tetrisGrid[newY][newX]) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }
        
        function rotateTetrisPiece() {
            if (!currentTetrisPiece) return;
            
            const rotated = [];
            for (let i = 0; i < currentTetrisPiece.shape[0].length; i++) {
                rotated.push([]);
                for (let j = currentTetrisPiece.shape.length - 1; j >= 0; j--) {
                    rotated[i].push(currentTetrisPiece.shape[j][i]);
                }
            }
            
            if (!checkTetrisCollision(currentTetrisPiece.x, currentTetrisPiece.y, rotated)) {
                currentTetrisPiece.shape = rotated;
                renderTetris();
            }
        }
        
        function renderTetris() {
            tetrisGameContainer.innerHTML = '';
            
            // Update sand particles
            updateSandParticles();
            
            // Render grid blocks
            for (let y = 0; y < tetrisGrid.length; y++) {
                for (let x = 0; x < tetrisGrid[y].length; x++) {
                    if (tetrisGrid[y][x]) {
                        const block = document.createElement('div');
                        block.className = 'tetris-block';
                        block.style.left = `${x * 20}px`;
                        block.style.top = `${y * 20}px`;
                        tetrisGameContainer.appendChild(block);
                    }
                }
            }
            
            // Render current piece
            if (currentTetrisPiece) {
                for (let y = 0; y < currentTetrisPiece.shape.length; y++) {
                    for (let x = 0; x < currentTetrisPiece.shape[y].length; x++) {
                        if (currentTetrisPiece.shape[y][x]) {
                            const block = document.createElement('div');
                            block.className = 'tetris-block';
                            block.style.left = `${(currentTetrisPiece.x + x) * 20}px`;
                            block.style.top = `${(currentTetrisPiece.y + y) * 20}px`;
                            tetrisGameContainer.appendChild(block);
                        }
                    }
                }
            }
        }
        
        function spawnFood() {
            const maxX = Math.floor(snakeGameContainer.offsetWidth / 20) - 1;
            const maxY = Math.floor(snakeGameContainer.offsetHeight / 20) - 1;
            
            food = {
                x: Math.floor(Math.random() * maxX) * 20,
                y: Math.floor(Math.random() * maxY) * 20
            };
            
            for (const segment of snake) {
                if (segment.x === food.x && segment.y === food.y) {
                    return spawnFood();
                }
            }
        }
        
        function updateSnakeGame() {
            const head = {...snake[0]};
            
            switch(direction) {
                case 'up':
                    head.y -= 20;
                    break;
                case 'down':
                    head.y += 20;
                    break;
                case 'left':
                    head.x -= 20;
                    break;
                case 'right':
                    head.x += 20;
                    break;
            }
            
            if (
                head.x < 0 || 
                head.y < 0 || 
                head.x >= snakeGameContainer.offsetWidth || 
                head.y >= snakeGameContainer.offsetHeight ||
                snake.some(segment => segment.x === head.x && segment.y === head.y)
            ) {
                gameOver();
                return;
            }
            
            snake.unshift(head);
            
            if (head.x === food.x && head.y === food.y) {
                snakeScoreValue += 10;
                snakeScore.textContent = `–°—á–µ—Ç: ${snakeScoreValue}`;
                spawnFood();
            } else {
                snake.pop();
            }
            
            renderSnake();
            renderFood();
        }
        
        function renderSnake() {
            const snakeSegments = document.querySelectorAll('.snake-segment');
            snakeSegments.forEach(segment => segment.remove());
            
            for (const segment of snake) {
                const snakeElement = document.createElement('div');
                snakeElement.className = 'snake-segment';
                snakeElement.style.left = `${segment.x}px`;
                snakeElement.style.top = `${segment.y}px`;
                snakeGameContainer.appendChild(snakeElement);
            }
        }
        
        function renderFood() {
            const foodElements = document.querySelectorAll('.snake-food');
            foodElements.forEach(food => food.remove());
            
            const foodElement = document.createElement('div');
            foodElement.className = 'snake-food';
            foodElement.style.left = `${food.x}px`;
            foodElement.style.top = `${food.y}px`;
            snakeGameContainer.appendChild(foodElement);
        }
        
        function gameOver() {
            isGameRunning = false;
            clearInterval(obstacleInterval);
            clearInterval(snakeGameInterval);
            clearInterval(tetrisGameInterval);
            speak(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –í–∞—à —Å—á–µ—Ç: ${gameScoreValue || snakeScoreValue || tetrisScoreValue}`);
        }
        
        function updateGame() {
            gameScoreValue++;
            gameScore.textContent = `–°—á–µ—Ç: ${Math.floor(gameScoreValue / 10)}`;
            
            if (isJumping) {
                jumpHeight += 8; // Increased jump speed
                gameCharacter.style.bottom = `${jumpHeight}px`;
                
                if (jumpHeight > 120) { // Higher jump
                    isJumping = false;
                }
            } else if (parseInt(gameCharacter.style.bottom || '0') > 0) {
                jumpHeight -= 6; // Faster fall
                gameCharacter.style.bottom = `${jumpHeight}px`;
            }
            
            obstaclePosition -= gameSpeed;
            
            let obstacle = document.querySelector('.game-obstacle');
            if (!obstacle) {
                obstacle = document.createElement('div');
                obstacle.className = 'game-obstacle';
                gameContainer.appendChild(obstacle);
            }
            
            obstacle.style.right = `${600 - obstaclePosition}px`;
            
            if (obstaclePosition < -30) {
                obstaclePosition = 600 + Math.random() * 200;
                gameSpeed += 0.2;
            }
            
            if (checkCollision()) {
                gameOver();
            }
        }
        
        function checkCollision() {
            const characterRect = gameCharacter.getBoundingClientRect();
            const obstacle = document.querySelector('.game-obstacle');
            
            if (!obstacle) return false;
            
            const obstacleRect = obstacle.getBoundingClientRect();
            
            return !(
                characterRect.right < obstacleRect.left ||
                characterRect.left > obstacleRect.right ||
                characterRect.bottom < obstacleRect.top ||
                characterRect.top > obstacleRect.bottom
            );
        }
        
        function jump() {
            if (parseInt(gameCharacter.style.bottom || '0') === 0) {
                isJumping = true;
                jumpHeight = 0;
                gameCharacter.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    gameCharacter.style.transform = 'scale(1)';
                }, 200);
            }
        }
        
        function loadAllData() {
            const savedChats = localStorage.getItem('chatSessions');
            if (savedChats) {
                chats = JSON.parse(savedChats);
            }
            
            if (!chats[activeChatId]) {
                chats[activeChatId] = {
                    history: [],
                    notes: ''
                };
            }
            
            conversationHistory = chats[activeChatId].history;
            notesArea.value = chats[activeChatId].notes;
            
            loadSettings();
            loadRecentFiles();
        }
        
        function saveAllData() {
            chats[activeChatId].history = conversationHistory;
            chats[activeChatId].notes = notesArea.value;
            localStorage.setItem('chatSessions', JSON.stringify(chats));
        }
        
        function renderChatTabs() {
            chatTabs.innerHTML = '';
            
            Object.keys(chats).forEach(chatId => {
                const tab = document.createElement('div');
                tab.className = `chat-tab ${chatId === activeChatId ? 'active' : ''}`;
                tab.textContent = `–ß–∞—Ç ${chatId === 'default' ? '1' : Object.keys(chats).indexOf(chatId) + 1}`;
                tab.onclick = () => switchChat(chatId);
                
                if (chatId !== 'default') {
                    const closeBtn = document.createElement('span');
                    closeBtn.className = 'chat-tab-close';
                    closeBtn.innerHTML = '&times;';
                    closeBtn.onclick = (e) => {
                        e.stopPropagation();
                        closeChat(chatId);
                    };
                    tab.appendChild(closeBtn);
                }
                
                chatTabs.appendChild(tab);
            });
            
            chatTabs.appendChild(newChatBtn);
        }
        
        function switchChat(chatId) {
            activeChatId = chatId;
            conversationHistory = chats[chatId].history;
            notesArea.value = chats[chatId].notes;
            renderConversation();
            renderChatTabs();
        }
        
        function createNewChat() {
            const newChatId = 'chat-' + Date.now();
            chats[newChatId] = {
                history: [],
                notes: ''
            };
            activeChatId = newChatId;
            conversationHistory = [];
            notesArea.value = '';
            renderConversation();
            renderChatTabs();
            
            setTimeout(() => {
                const welcomeMessage = '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –Ω–æ–≤—ã–π —á–∞—Ç. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?';
                addMessage('assistant', welcomeMessage, true);
                speak(welcomeMessage);
            }, 500);
        }
        
        function closeChat(chatId) {
            if (Object.keys(chats).length <= 1) return;
            
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —ç—Ç–æ—Ç —á–∞—Ç? –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞.')) {
                delete chats[chatId];
                
                const remainingChatIds = Object.keys(chats);
                activeChatId = remainingChatIds[0];
                conversationHistory = chats[activeChatId].history;
                notesArea.value = chats[activeChatId].notes;
                
                saveAllData();
                renderConversation();
                renderChatTabs();
            }
        }
        
        function handleHotkeys(e) {
            if (e.ctrlKey && e.key === 'k') {
                e.preventDefault();
                textInput.focus();
            }
            if (e.ctrlKey && e.key === 'l') {
                e.preventDefault();
                toggleVoiceRecognition();
            }
            if (e.ctrlKey && e.key === 'Enter' && textInput.value.trim()) {
                e.preventDefault();
                processUserInput(textInput.value);
                textInput.value = '';
            }
            if (e.ctrlKey && e.key === 'ArrowUp') {
                e.preventDefault();
                openFileExplorer();
            }
            if (e.ctrlKey && e.key === 'ArrowDown') {
                e.preventDefault();
                openNotesExplorer();
            }
            if (e.ctrlKey && e.key === 'ArrowLeft') {
                e.preventDefault();
                openEntertainmentExplorer();
            }
            if (e.ctrlKey && e.key === 'ArrowRight') {
                e.preventDefault();
                openSettingsExplorer();
            }
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                createNewChat();
            }
            if (e.key === ' ' && offlineGame.style.display === 'flex') {
                e.preventDefault();
                jump();
            }
            if (e.key === 'ArrowUp' && snakeGame.style.display === 'flex' && direction !== 'down') {
                e.preventDefault();
                direction = 'up';
            }
            if (e.key === 'ArrowDown' && snakeGame.style.display === 'flex' && direction !== 'up') {
                e.preventDefault();
                direction = 'down';
            }
            if (e.key === 'ArrowLeft' && snakeGame.style.display === 'flex' && direction !== 'right') {
                e.preventDefault();
                direction = 'left';
            }
            if (e.key === 'ArrowRight' && snakeGame.style.display === 'flex' && direction !== 'left') {
                e.preventDefault();
                direction = 'right';
            }
            if (e.key === 'ArrowUp' && tetrisGame.style.display === 'flex') {
                e.preventDefault();
                rotateTetrisPiece();
            }
            if (e.key === 'ArrowDown' && tetrisGame.style.display === 'flex') {
                e.preventDefault();
                if (!checkTetrisCollision(currentTetrisPiece.x, currentTetrisPiece.y + 1, currentTetrisPiece.shape)) {
                    currentTetrisPiece.y++;
                    renderTetris();
                }
            }
            if (e.key === 'ArrowLeft' && tetrisGame.style.display === 'flex') {
                e.preventDefault();
                if (!checkTetrisCollision(currentTetrisPiece.x - 1, currentTetrisPiece.y, currentTetrisPiece.shape)) {
                    currentTetrisPiece.x--;
                    renderTetris();
                }
            }
            if (e.key === 'ArrowRight' && tetrisGame.style.display === 'flex') {
                e.preventDefault();
                if (!checkTetrisCollision(currentTetrisPiece.x + 1, currentTetrisPiece.y, currentTetrisPiece.shape)) {
                    currentTetrisPiece.x++;
                    renderTetris();
                }
            }
        }
        
        function startInactivityTimer() {
            resetInactivityTimer();
            
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
                document.addEventListener(event, resetInactivityTimer);
            });
        }
        
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                if (isListening) {
                    recognition.stop();
                }
                speak('–Ø –æ—Ç–∫–ª—é—á–∞—é—Å—å –∏–∑-–∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥.');
            }, 7200000);
        }
        
        function loadRecentFiles() {
            const savedFiles = localStorage.getItem('recentFiles');
            if (savedFiles) {
                recentFiles = JSON.parse(savedFiles);
                updateRecommendations();
            }
        }
        
        function saveRecentFiles() {
            localStorage.setItem('recentFiles', JSON.stringify(recentFiles));
        }
        
        function addToRecentFiles(file) {
            const existingIndex = recentFiles.findIndex(f => f.path === file.path);
            if (existingIndex !== -1) {
                recentFiles.splice(existingIndex, 1);
            }
            recentFiles.unshift(file);
            if (recentFiles.length > 5) {
                recentFiles.pop();
            }
            saveRecentFiles();
            updateRecommendations();
        }
        
        function updateRecommendations() {
            recommendationsList.innerHTML = '';
            
            if (recentFiles.length === 0) {
                recommendationsList.innerHTML = '<p>–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤</p>';
                return;
            }
            
            const historyHeader = document.createElement('div');
            historyHeader.className = 'window-header';
            historyHeader.innerHTML = '<i class="fas fa-clock"></i> –ù–µ–¥–∞–≤–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ';
            recommendationsList.appendChild(historyHeader);
            
            recentFiles.forEach(file => {
                const item = document.createElement('div');
                item.className = 'recommendation-item';
                const extension = file.name.split('.').pop().toLowerCase();
                const icon = fileIcons[extension] || 'üìÑ';
                item.innerHTML = `${icon} ${file.name}`;
                item.onclick = async () => {
                    selectedFile = file;
                    await openSelectedFile();
                };
                recommendationsList.appendChild(item);
            });
        }
        
        function loadSettings() {
            const savedSettings = localStorage.getItem('appSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                volumeControl.value = settings.volume || 1;
                rateControl.value = settings.rate || 1;
                themeControl.checked = settings.darkTheme !== false;
                noiseSuppressionControl.checked = settings.noiseSuppression || false;
                noiseSuppressionEnabled = settings.noiseSuppression || false;
                updateNoiseSuppressionIndicator();
                applyTheme(settings.darkTheme !== false);
            }
        }
        
        function saveSettings() {
            const settings = {
                volume: parseFloat(volumeControl.value),
                rate: parseFloat(rateControl.value),
                darkTheme: themeControl.checked,
                noiseSuppression: noiseSuppressionControl.checked
            };
            
            noiseSuppressionEnabled = noiseSuppressionControl.checked;
            updateNoiseSuppressionIndicator();
            
            localStorage.setItem('appSettings', JSON.stringify(settings));
            speak('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.');
        }
        
        function updateNoiseSuppressionIndicator() {
            if (noiseSuppressionEnabled) {
                noiseSuppressionIndicator.style.display = 'block';
            } else {
                noiseSuppressionIndicator.style.display = 'none';
            }
        }
        
        function applyTheme(isDark) {
            if (isDark) {
                document.documentElement.style.setProperty('--bg-color', '#121212');
                document.documentElement.style.setProperty('--text-color', '#f5f5f5');
            } else {
                document.documentElement.style.setProperty('--bg-color', '#f5f5f5');
                document.documentElement.style.setProperty('--text-color', '#121212');
            }
        }
        
        function renderConversation() {
            chatArea.innerHTML = '';
            conversationHistory.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(`${msg.sender}-message`);
                
                const formattedText = msg.text.split('\n').map(paragraph => {
                    return paragraph.trim() ? `<p>${paragraph}</p>` : '';
                }).join('');
                
                messageDiv.innerHTML = formattedText;
                chatArea.appendChild(messageDiv);
            });
            chatArea.scrollTop = chatArea.scrollHeight;
        }
        
        function showTypingIndicator() {
            if (isTyping) return;
            
            isTyping = true;
            const typingDiv = document.createElement('div');
            typingDiv.classList.add('typing-indicator');
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            chatArea.appendChild(typingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }
        
        function hideTypingIndicator() {
            isTyping = false;
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        function speak(text) {
            if (isAssistantSpeaking || lastSpokenMessage === text) return;
            
            lastSpokenMessage = text;
            isAssistantSpeaking = true;
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessage('assistant', text);
                
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ru-RU';
                utterance.rate = parseFloat(rateControl.value);
                utterance.pitch = 1;
                utterance.volume = parseFloat(volumeControl.value);
                
                const voices = window.speechSynthesis.getVoices();
                if (voices.length > 0) {
                    const russianVoices = voices.filter(v => v.lang.includes('ru'));
                    if (russianVoices.length > 0) {
                        utterance.voice = russianVoices.reduce((best, current) => 
                            current.name.includes('Microsoft') || current.name.includes('Google') ? current : best
                        );
                    }
                }
                
                utterance.onend = () => {
                    isAssistantSpeaking = false;
                    lastSpokenMessage = '';
                };
                
                utterance.onerror = () => {
                    isAssistantSpeaking = false;
                    lastSpokenMessage = '';
                };
                
                speechSynthesis.speak(utterance);
            }, 800);
        }
        
        function processUserInput(input) {
            if (!input.trim()) return;
            
            addMessage('user', input);
            processCommandWithAI(input);
        }
        
        async function processCommandWithAI(input) {
            showTypingIndicator();
            
            try {
                const context = conversationHistory
                    .slice(-6)
                    .map(msg => `${msg.sender === 'user' ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' : '–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç'}: ${msg.text}`)
                    .join('\n');
                
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                const response = await generateAIResponse(input, context);
                speak(response);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã:', error);
                hideTypingIndicator();
                speak('–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        }
        
        async function generateAIResponse(input, context) {
            const lowerInput = input.toLowerCase();
            
            if (/(–ø—Ä–∏–≤–µ—Ç|–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π)/i.test(lowerInput)) {
                return '–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?';
            }
            else if (/(–ø–æ–∫–∞|–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è)/i.test(lowerInput)) {
                return '–î–æ —Å–≤–∏–¥–∞–Ω–∏—è! –ë—É–¥—É —Ä–∞–¥ –ø–æ–º–æ—á—å –≤–∞–º —Å–Ω–æ–≤–∞.';
            }
            else if (/(–æ—Ç–∫—Ä–æ–π –¥–æ—Å—Ç—É–ø|–ø–æ–∫–∞–∂–∏ —Ñ–∞–π–ª—ã|–Ω–∞–π–¥–∏ —Ñ–∞–π–ª|–Ω–∞–π–¥–∏ –ø–∞–ø–∫—É)/i.test(lowerInput)) {
                openFileExplorer();
                return handleFileCommands(input);
            }
            else if (/(–∑–∞–º–µ—Ç–∫–∏|–∑–∞–ø–∏—Å–∫–∏|–∑–∞–ø–∏—à–∏)/i.test(lowerInput)) {
                return handleNotesCommands(input);
            }
            else if (/(—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è|–∏–≥—Ä–∞|–º–µ–ª–æ–¥–∏—è|–≥–∞–¥–∞–Ω–∏–µ|—Ç–æ—Å—Ç|—Å—Ç–∏—Ö)/i.test(lowerInput)) {
                return handleEntertainmentCommands(input);
            }
            else if (/(–Ω–∞—Å—Ç—Ä–æ–π–∫–∏|–ø–∞—Ä–∞–º–µ—Ç—Ä—ã)/i.test(lowerInput)) {
                openSettingsExplorer();
                return '–û—Ç–∫—Ä—ã–≤–∞—é –Ω–∞—Å—Ç—Ä–æ–π–∫–∏. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å, —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏ –∏ —Ç–µ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.';
            }
            else if (/(–∫–∞–∫ –¥–µ–ª–∞|–∫–∞–∫ —Ç—ã|–∫–∞–∫ –∂–∏–∑–Ω—å)/i.test(lowerInput)) {
                return '–£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ! –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏.';
            }
            else if (/(—Å–ø–∞—Å–∏–±–æ|–±–ª–∞–≥–æ–¥–∞—Ä—é)/i.test(lowerInput)) {
                return '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å, –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –µ—â—ë –ø–æ–º–æ—â—å.';
            }
            else if (/(—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å|—Ç–≤–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏)/i.test(lowerInput)) {
                return '–Ø –º–æ–≥—É –Ω–∞—Ö–æ–¥–∏—Ç—å —Ñ–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏ –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ, —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏, —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∞–π–ª–∞–º–∏, –∏–≥—Ä–∞—Ç—å –≤ "—É–≥–∞–¥–∞–π –º–µ–ª–æ–¥–∏—é", –≥–∞–¥–∞—Ç—å, –Ω–∞—Ö–æ–¥–∏—Ç—å —Ç–æ—Å—Ç—ã, —á–∏—Ç–∞—Ç—å —Å—Ç–∏—Ö–∏ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ!';
            }
            else if (/(–ø–æ–∫–∞–∂–∏ –≤—Å–µ –ø–∞–ø–∫–∏|–Ω–∞–π–¥–∏ –≤—Å–µ –ø–∞–ø–∫–∏|—Å–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫)/i.test(lowerInput)) {
                const folders = [];
                fileHandles.forEach((handle, path) => {
                    if (handle.kind === 'directory') {
                        folders.push(path.split('/').pop());
                    }
                });
                
                if (folders.length > 0) {
                    let response = '–í–æ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞–ø–∫–∏:\n';
                    folders.forEach(folder => {
                        response += `- ${folder}\n`;
                    });
                    return response + '–°–∫–∞–∂–∏—Ç–µ "–æ—Ç–∫—Ä—ã—Ç—å [–Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏]" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ.';
                } else {
                    return '–ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–∞–ø–æ–∫.';
                }
            }
            else if (/(–æ—Ç–∫—Ä–æ–π|–ø–æ–∫–∞–∂–∏) (.+)/i.test(lowerInput)) {
                const match = input.match(/(–æ—Ç–∫—Ä–æ–π|–ø–æ–∫–∞–∂–∏) (.+)/i);
                if (match && match[2]) {
                    const itemName = match[2].trim();
                    let foundHandle = null;
                    let foundPath = null;
                    
                    fileHandles.forEach((handle, path) => {
                        if (path.includes(itemName)) {
                            foundHandle = handle;
                            foundPath = path;
                        }
                    });
                    
                    if (foundHandle) {
                        selectedFile = {
                            name: foundPath.split('/').pop(),
                            path: foundPath,
                            type: foundHandle.kind === 'file' ? 'file' : 'directory'
                        };
                        
                        if (foundHandle.kind === 'directory') {
                            return `–û—Ç–∫—Ä—ã–≤–∞—é –ø–∞–ø–∫—É "${itemName}". –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –µ—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.`;
                        } else {
                            openSelectedFile();
                            return `–û—Ç–∫—Ä—ã–≤–∞—é —Ñ–∞–π–ª "${itemName}".`;
                        }
                    } else {
                        return `–§–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫–∞ "${itemName}" –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.`;
                    }
                }
            }
            else if (/(—É–¥–∞–ª–∏—Ç—å|—É–¥–∞–ª–∏) (.+)/i.test(lowerInput)) {
                const match = input.match(/(—É–¥–∞–ª–∏—Ç—å|—É–¥–∞–ª–∏) (.+)/i);
                if (match && match[2]) {
                    const itemName = match[2].trim();
                    let foundHandle = null;
                    let foundPath = null;
                    
                    fileHandles.forEach((handle, path) => {
                        if (path.includes(itemName)) {
                            foundHandle = handle;
                            foundPath = path;
                        }
                    });
                    
                    if (foundHandle) {
                        selectedFile = {
                            name: foundPath.split('/').pop(),
                            path: foundPath,
                            type: foundHandle.kind === 'file' ? 'file' : 'directory'
                        };
                        
                        if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${selectedFile.name}"?`)) {
                            try {
                                await foundHandle.remove();
                                fileHandles.delete(foundPath);
                                speak(`–§–∞–π–ª "${selectedFile.name}" —É–¥–∞–ª–µ–Ω.`);
                                selectedFile = null;
                                filePreview.classList.remove('active');
                                renderFileSystem();
                                return `–§–∞–π–ª "${itemName}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.`;
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                                return '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª.';
                            }
                        } else {
                            return '–£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ.';
                        }
                    } else {
                        return `–§–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫–∞ "${itemName}" –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.`;
                    }
                }
            }
            else if (/(–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å|–ø–µ—Ä–µ–∏–º–µ–Ω—É–π) (.+)/i.test(lowerInput)) {
                const match = input.match(/(–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å|–ø–µ—Ä–µ–∏–º–µ–Ω—É–π) (.+)/i);
                if (match && match[2]) {
                    const parts = match[2].split(' –≤ ');
                    if (parts.length === 2) {
                        const oldName = parts[0].trim();
                        const newName = parts[1].trim();
                        
                        let foundHandle = null;
                        let foundPath = null;
                        
                        fileHandles.forEach((handle, path) => {
                            if (path.includes(oldName)) {
                                foundHandle = handle;
                                foundPath = path;
                            }
                        });
                        
                        if (foundHandle) {
                            try {
                                await foundHandle.move(newName);
                                fileHandles.delete(foundPath);
                                
                                const newPath = foundPath.split('/').slice(0, -1).concat(newName).join('/');
                                fileHandles.set(newPath, foundHandle);
                                
                                renderFileSystem();
                                return `–§–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –∏–∑ "${oldName}" –≤ "${newName}".`;
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                                return '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª.';
                            }
                        } else {
                            return `–§–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫–∞ "${oldName}" –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.`;
                        }
                    } else {
                        return '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ: "–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Å—Ç–∞—Ä–æ–µ_–∏–º—è –≤ –Ω–æ–≤–æ–µ_–∏–º—è"';
                    }
                }
            }
            else if (/(—Ç–∏–ø|—á—Ç–æ —ç—Ç–æ) (.+)/i.test(lowerInput)) {
                const match = input.match(/(—Ç–∏–ø|—á—Ç–æ —ç—Ç–æ) (.+)/i);
                if (match && match[2]) {
                    const itemName = match[2].trim();
                    let foundHandle = null;
                    let foundPath = null;
                    
                    fileHandles.forEach((handle, path) => {
                        if (path.includes(itemName)) {
                            foundHandle = handle;
                            foundPath = path;
                        }
                    });
                    
                    if (foundHandle) {
                        const fileName = foundPath.split('/').pop();
                        const extension = fileName.split('.').pop().toLowerCase();
                        const fileType = fileTypes[extension] || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞';
                        
                        if (foundHandle.kind === 'directory') {
                            return `"${fileName}" - —ç—Ç–æ –ø–∞–ø–∫–∞.`;
                        } else {
                            return `"${fileName}" - —ç—Ç–æ ${fileType}.`;
                        }
                    } else {
                        return `–§–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫–∞ "${itemName}" –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.`;
                    }
                }
            }
            else if (/(–æ–±–Ω–æ–≤–∏—Ç—å)/i.test(lowerInput)) {
                renderFileSystem();
                return '–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω.';
            }
            else if (/(–∏—Å—Ç–æ—Ä–∏—è|—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)/i.test(lowerInput)) {
                if (recentFiles.length > 0) {
                    let response = '–ù–µ–¥–∞–≤–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã:\n';
                    recentFiles.forEach(file => {
                        response += `- ${file.name}\n`;
                    });
                    return response + '–í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –ª—é–±–æ–π –∏–∑ –Ω–∏—Ö –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è.';
                } else {
                    return '–í—ã –µ—â–µ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–ª–∏ —Ñ–∞–π–ª—ã. –ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞.';
                }
            }
            else if (/(–Ω–æ–≤—ã–π —á–∞—Ç)/i.test(lowerInput)) {
                createNewChat();
                return '–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —á–∞—Ç. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?';
            }
            else if (/(–Ω–∞–∑–∞–¥|–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥)/i.test(lowerInput)) {
                navigateBack();
                return '–í–æ–∑–≤—Ä–∞—â–∞—é—Å—å –Ω–∞–∑–∞–¥.';
            }
            else if (/(–≤–ø–µ—Ä–µ–¥|–≤–µ—Ä–Ω—É—Ç—å—Å—è –≤–ø–µ—Ä–µ–¥)/i.test(lowerInput)) {
                navigateForward();
                return '–ü–µ—Ä–µ—Ö–æ–∂—É –≤–ø–µ—Ä–µ–¥.';
            }
            else if (/(–≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫|–ø—Ä–æ–≤–æ–¥–Ω–∏–∫)/i.test(lowerInput)) {
                openFileExplorer();
                return '–û—Ç–∫—Ä—ã–≤–∞—é —Ñ–∞–π–ª–æ–≤—ã–π –ø—Ä–æ–≤–æ–¥–Ω–∏–∫.';
            }
            else if (/(–≤—ã–±—Ä–∞—Ç—å –ø–∞–ø–∫—É|–æ—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É)/i.test(lowerInput)) {
                browseFilesBtn.click();
                return '–û—Ç–∫—Ä—ã–≤–∞—é –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–∞–ø–∫–∏.';
            }
            else if (/(–≤—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª|–æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª)/i.test(lowerInput)) {
                browseFilesBtn.click();
                return '–û—Ç–∫—Ä—ã–≤–∞—é –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞.';
            }
            else if (/(—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à–∫–æ–π|—É–ø—Ä–∞–≤–ª—è—Ç—å –º—ã—à–∫–æ–π)/i.test(lowerInput)) {
                moveMouse();
                return '–†–µ–∂–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º—ã—à–∫–æ–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –°–∫–∞–∂–∏—Ç–µ "–≤–ª–µ–≤–æ", "–≤–ø—Ä–∞–≤–æ", "–≤–≤–µ—Ä—Ö" –∏–ª–∏ "–≤–Ω–∏–∑" –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è. "–ö–ª–∏–∫" –¥–ª—è –Ω–∞–∂–∞—Ç–∏—è. "–û—Ç–º–µ–Ω–∞" –¥–ª—è –≤—ã—Ö–æ–¥–∞.';
            }
            else if (/(–≤–ª–µ–≤–æ|–¥–≤–∏–≥–∞–π –≤–ª–µ–≤–æ)/i.test(lowerInput)) {
                moveMouse('left');
                return '–ü–µ—Ä–µ–º–µ—â–∞—é –∫—É—Ä—Å–æ—Ä –≤–ª–µ–≤–æ.';
            }
            else if (/(–≤–ø—Ä–∞–≤–æ|–¥–≤–∏–≥–∞–π –≤–ø—Ä–∞–≤–æ)/i.test(lowerInput)) {
                moveMouse('right');
                return '–ü–µ—Ä–µ–º–µ—â–∞—é –∫—É—Ä—Å–æ—Ä –≤–ø—Ä–∞–≤–æ.';
            }
            else if (/(–≤–≤–µ—Ä—Ö|–¥–≤–∏–≥–∞–π –≤–≤–µ—Ä—Ö)/i.test(lowerInput)) {
                moveMouse('up');
                return '–ü–µ—Ä–µ–º–µ—â–∞—é –∫—É—Ä—Å–æ—Ä –≤–≤–µ—Ä—Ö.';
            }
            else if (/(–≤–Ω–∏–∑|–¥–≤–∏–≥–∞–π –≤–Ω–∏–∑)/i.test(lowerInput)) {
                moveMouse('down');
                return '–ü–µ—Ä–µ–º–µ—â–∞—é –∫—É—Ä—Å–æ—Ä –≤–Ω–∏–∑.';
            }
            else if (/(–∫–ª–∏–∫|–Ω–∞–∂–º–∏)/i.test(lowerInput)) {
                simulateMouseClick(mouseX, mouseY);
                return '–í—ã–ø–æ–ª–Ω—è—é –∫–ª–∏–∫.';
            }
            else if (/(–æ—Ç–º–µ–Ω–∞|–≤—ã–π—Ç–∏|–∑–∞–∫–æ–Ω—á–∏—Ç—å)/i.test(lowerInput)) {
                stopMouseControl();
                return '–†–µ–∂–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º—ã—à–∫–æ–π –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.';
            }
            else if (/(—Å–æ–Ω|—Å–ø—è—â–∏–π —Ä–µ–∂–∏–º)/i.test(lowerInput)) {
                return '–ü–µ—Ä–µ–≤–æ–∂—É —Å–∏—Å—Ç–µ–º—É –≤ —Å–ø—è—â–∏–π —Ä–µ–∂–∏–º.';
            }
            else if (/(–≤—ã–∫–ª—é—á–∏—Ç—å|–≤—ã–∫–ª—é—á–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä)/i.test(lowerInput)) {
                return '–í—ã–∫–ª—é—á–∞—é –∫–æ–º–ø—å—é—Ç–µ—Ä.';
            }
            else if (/(–∑–∞–ø—É—Å—Ç–∏ –∏–≥—Ä—É|–∏–≥—Ä–∞—Ç—å)/i.test(lowerInput)) {
                openEntertainmentExplorer();
                return '–û—Ç–∫—Ä—ã–≤–∞—é –º–µ–Ω—é –∏–≥—Ä. –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞.';
            }
            else if (/(–∑–∞–ø—É—Å—Ç–∏ –¥–∏–Ω–æ–∑–∞–≤—Ä–∏–∫–∞|–¥–∏–Ω–æ–∑–∞–≤—Ä–∏–∫)/i.test(lowerInput)) {
                startOfflineGame();
                return '–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–î–∏–Ω–æ–∑–∞–≤—Ä–∏–∫". –ù–∞–∂–º–∏—Ç–µ –ø—Ä–æ–±–µ–ª, —á—Ç–æ–±—ã –ø—Ä—ã–≥–∞—Ç—å!';
            }
            else if (/(–∑–∞–ø—É—Å—Ç–∏ –∑–º–µ–π–∫—É|–∑–º–µ–π–∫–∞)/i.test(lowerInput)) {
                startSnakeGame();
                return '–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–ó–º–µ–π–∫–∞". –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.';
            }
            else if (/(–∑–∞–ø—É—Å—Ç–∏ —Ç–µ—Ç—Ä–∏—Å|—Ç–µ—Ç—Ä–∏—Å)/i.test(lowerInput)) {
                startTetrisGame();
                return '–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–¢–µ—Ç—Ä–∏—Å". –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.';
            }
            else if (/(–µ—â–µ —Ä–∞–∑|–ø–æ–≤—Ç–æ—Ä–∏|—Å–Ω–æ–≤–∞)/i.test(lowerInput)) {
                if (offlineGame.style.display === 'flex') {
                    startOfflineGame();
                    return '–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–î–∏–Ω–æ–∑–∞–≤—Ä–∏–∫" —Å–Ω–æ–≤–∞.';
                } else if (snakeGame.style.display === 'flex') {
                    startSnakeGame();
                    return '–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–ó–º–µ–π–∫–∞" —Å–Ω–æ–≤–∞.';
                } else if (tetrisGame.style.display === 'flex') {
                    startTetrisGame();
                    return '–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–¢–µ—Ç—Ä–∏—Å" —Å–Ω–æ–≤–∞.';
                } else {
                    return '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏–≥—Ä—É.';
                }
            }
            else if (/(–∫–æ–º–∞–Ω–¥—ã|—Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥)/i.test(lowerInput)) {
                return '–í–æ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:\n' +
                       '- –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª—ã/–ø–∞–ø–∫–∏\n' +
                       '- –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏\n' +
                       '- –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è (–∏–≥—Ä—ã, –≥–∞–¥–∞–Ω–∏—è, —Ç–æ—Å—Ç—ã)\n' +
                       '- –ù–∞—Å—Ç—Ä–æ–π–∫–∏\n' +
                       '- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à–∫–æ–π\n' +
                       '- –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É (–¥–∏–Ω–æ–∑–∞–≤—Ä–∏–∫, –∑–º–µ–π–∫–∞, —Ç–µ—Ç—Ä–∏—Å)\n' +
                       '- –ï—â–µ —Ä–∞–∑ (–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ–∫—É—â—É—é –∏–≥—Ä—É)\n' +
                       '- –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã\n' +
                       '- –ù–æ–≤—ã–π —á–∞—Ç\n' +
                       '- –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç';
            }
            else {
                return await getOpenAIResponse(input, context);
            }
        }
        
        function navigateBack() {
            if (currentWindow === 'settings') {
                openEntertainmentExplorer();
            } else if (currentWindow === 'entertainment') {
                openNotesExplorer();
            } else if (currentWindow === 'notes') {
                openFileExplorer();
            }
        }
        
        function navigateForward() {
            if (currentWindow === 'files') {
                openNotesExplorer();
            } else if (currentWindow === 'notes') {
                openEntertainmentExplorer();
            } else if (currentWindow === 'entertainment') {
                openSettingsExplorer();
            }
        }
        
        async function getOpenAIResponse(input, context) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            {
                                role: "system",
                                content: "–¢—ã —É–º–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É."
                            },
                            {
                                role: "user",
                                content: input
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 150
                    })
                });
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ OpenAI API');
                }
                
                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ OpenAI:', error);
                return `–Ø –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å: "${input}". –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ –º–æ–≥—É –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.`;
            }
        }
        
        function handleFileCommands(command) {
            if (/(–Ω–∞–π–¥–∏ —Ñ–∞–π–ª|–Ω–∞–π–¥–∏ –ø–∞–ø–∫—É)/i.test(command)) {
                const searchQuery = command.replace(/(–Ω–∞–π–¥–∏ —Ñ–∞–π–ª|–Ω–∞–π–¥–∏ –ø–∞–ø–∫—É)/i, '').trim();
                if (searchQuery) {
                    const results = [];
                    fileHandles.forEach((handle, path) => {
                        if (path.toLowerCase().includes(searchQuery.toLowerCase())) {
                            results.push(path);
                        }
                    });
                    
                    if (results.length > 0) {
                        let response = `–ù–∞–π–¥–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å—É "${searchQuery}":\n`;
                        results.forEach(item => {
                            response += `- ${item}\n`;
                        });
                        response += '–°–∫–∞–∂–∏—Ç–µ "–æ—Ç–∫—Ä—ã—Ç—å [–Ω–∞–∑–≤–∞–Ω–∏–µ]" –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–∞–ø–∫–∏.';
                        return response;
                    } else {
                        return `–ü–æ –∑–∞–ø—Ä–æ—Å—É "${searchQuery}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.`;
                    }
                } else {
                    return '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ, –∫–∞–∫–æ–π —Ñ–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫—É –≤—ã —Ö–æ—Ç–∏—Ç–µ –Ω–∞–π—Ç–∏.';
                }
            }
            return '–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞. –î–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º —É–∂–µ –æ—Ç–∫—Ä—ã—Ç.';
        }
        
        function handleNotesCommands(command) {
            if (/(–ø–æ–∫–∞–∂–∏ –∑–∞–º–µ—Ç–∫–∏|–æ—Ç–∫—Ä–æ–π –∑–∞–º–µ—Ç–∫–∏)/i.test(command)) {
                openNotesExplorer();
                return '–û—Ç–∫—Ä—ã–≤–∞—é –≤–∞—à–∏ –∑–∞–º–µ—Ç–∫–∏. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∑–¥–µ—Å—å.';
            }
            else if (/(—Å–æ—Ö—Ä–∞–Ω–∏ –∑–∞–º–µ—Ç–∫—É|–∑–∞–ø–∏—à–∏ –∑–∞–º–µ—Ç–∫—É)/i.test(command)) {
                const noteContent = command.replace(/(—Å–æ—Ö—Ä–∞–Ω–∏ –∑–∞–º–µ—Ç–∫—É|–∑–∞–ø–∏—à–∏ –∑–∞–º–µ—Ç–∫—É)/i, '').trim();
                if (noteContent) {
                    notesArea.value = noteContent;
                    saveNotes();
                    return '–ó–∞–º–µ—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞.';
                } else {
                    return '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏.';
                }
            }
            return '–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–º–µ—Ç–∫–∞–º–∏ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞. –°–∫–∞–∂–∏—Ç–µ "–æ—Ç–∫—Ä—ã—Ç—å –∑–∞–º–µ—Ç–∫–∏" –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.';
        }
        
        function handleEntertainmentCommands(command) {
            if (/(—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è|–∏–≥—Ä–∞|–º–µ–ª–æ–¥–∏—è|–≥–∞–¥–∞–Ω–∏–µ|—Ç–æ—Å—Ç|—Å—Ç–∏—Ö)/i.test(command)) {
                openEntertainmentExplorer();
                return '–û—Ç–∫—Ä—ã–≤–∞—é —Ä–∞–∑–¥–µ–ª —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –∏–≥—Ä–∞—Ç—å –≤ "—É–≥–∞–¥–∞–π –º–µ–ª–æ–¥–∏—é", –≥–∞–¥–∞—Ç—å, –Ω–∞–π—Ç–∏ —Ç–æ—Å—Ç –∏–ª–∏ –ø–æ—Å–ª—É—à–∞—Ç—å —Å—Ç–∏—Ö.';
            }
            return '–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞. –°–∫–∞–∂–∏—Ç–µ "—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è" –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é.';
        }
        
        function openFileExplorer() {
            fileExplorer.classList.add('active-window');
            notesExplorer.classList.remove('active-window');
            entertainmentExplorer.classList.remove('active-window');
            settingsExplorer.classList.remove('active-window');
            currentWindow = 'files';
            renderFileSystem();
        }
        
        function openNotesExplorer() {
            notesExplorer.classList.add('active-window');
            fileExplorer.classList.remove('active-window');
            entertainmentExplorer.classList.remove('active-window');
            settingsExplorer.classList.remove('active-window');
            currentWindow = 'notes';
        }
        
        function openEntertainmentExplorer() {
            entertainmentExplorer.classList.add('active-window');
            fileExplorer.classList.remove('active-window');
            notesExplorer.classList.remove('active-window');
            settingsExplorer.classList.remove('active-window');
            currentWindow = 'entertainment';
        }
        
        function openSettingsExplorer() {
            settingsExplorer.classList.add('active-window');
            fileExplorer.classList.remove('active-window');
            notesExplorer.classList.remove('active-window');
            entertainmentExplorer.classList.remove('active-window');
            currentWindow = 'settings';
        }
        
        function renderFileSystem() {
            fileExplorerContent.innerHTML = '';
            
            const groupedFiles = {};
            
            fileHandles.forEach((handle, path) => {
                const parts = path.split('/');
                let currentLevel = groupedFiles;
                
                for (let i = 0; i < parts.length; i++) {
                    const part = parts[i];
                    if (!currentLevel[part]) {
                        currentLevel[part] = {};
                    }
                    currentLevel = currentLevel[part];
                }
            });
            
            renderFileSystemLevel(groupedFiles, fileExplorerContent);
        }
        
        function renderFileSystemLevel(level, container, path = []) {
            for (const [name, content] of Object.entries(level)) {
                if (Object.keys(content).length > 0) {
                    const folderElement = document.createElement('div');
                    folderElement.className = 'folder-item';
                    
                    const toggleSpan = document.createElement('span');
                    toggleSpan.className = 'folder-toggle';
                    toggleSpan.innerHTML = '‚ñ∂';
                    toggleSpan.onclick = (e) => {
                        e.stopPropagation();
                        toggleSpan.classList.toggle('expanded');
                        const contents = folderElement.nextElementSibling;
                        contents.classList.toggle('expanded');
                    };
                    
                    folderElement.appendChild(toggleSpan);
                    folderElement.innerHTML += ` üìÅ ${name}`;
                    
                    folderElement.onclick = () => {
                        selectedFile = {
                            name: name,
                            path: [...path, name].join('/'),
                            type: 'directory'
                        };
                        speak(`–í—ã–±—Ä–∞–Ω–∞ –ø–∞–ø–∫–∞ "${name}". –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –µ—ë –≤ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–µ.`);
                    };
                    
                    container.appendChild(folderElement);
                    
                    const subContainer = document.createElement('div');
                    subContainer.className = 'folder-contents';
                    renderFileSystemLevel(content, subContainer, [...path, name]);
                    container.appendChild(subContainer);
                } else {
                    const fileElement = document.createElement('div');
                    fileElement.className = 'file-item';
                    
                    const extension = name.split('.').pop().toLowerCase();
                    const icon = fileIcons[extension] || 'üìÑ';
                    
                    fileElement.innerHTML = `${icon} ${name}`;
                    fileElement.onclick = async () => {
                        selectedFile = {
                            name: name,
                            path: [...path, name].join('/'),
                            type: 'file'
                        };
                        
                        const handle = fileHandles.get(selectedFile.path);
                        if (handle) {
                            try {
                                const file = await handle.getFile();
                                
                                if (file.type.startsWith('text/') || file.type === 'application/json') {
                                    const text = await file.text();
                                    filePreviewContent.innerHTML = `<pre>${text}</pre>`;
                                    filePreview.classList.add('active');
                                } else {
                                    filePreviewContent.innerHTML = `<p>–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞</p>`;
                                    filePreview.classList.add('active');
                                }
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                                filePreviewContent.innerHTML = `<p>–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞</p>`;
                                filePreview.classList.add('active');
                            }
                        }
                        
                        speak(`–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª "${name}". –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –µ–≥–æ –≤ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–µ, —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å.`);
                    };
                    container.appendChild(fileElement);
                }
            }
        }
        
        function saveNotes() {
            chats[activeChatId].notes = notesArea.value;
            saveAllData();
            speak('–ó–∞–º–µ—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.');
        }
        
        function playGuessMelody() {
            const melodies = ["Yesterday", "Smells Like Teen Spirit", "Bohemian Rhapsody", "Imagine"];
            const randomMelody = melodies[Math.floor(Math.random() * melodies.length)];
            speak(`–£–≥–∞–¥–∞–π—Ç–µ –º–µ–ª–æ–¥–∏—é: "${randomMelody}". –≠—Ç–æ The Beatles, Nirvana, Queen –∏–ª–∏ John Lennon?`);
        }
        
        function tellFortune() {
            const randomFortune = fortunes[Math.floor(Math.random() * fortunes.length)];
            speak(`–ú–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –¥–ª—è –≤–∞—Å: ${randomFortune}`);
        }
        
        function tellToast() {
            const randomToast = toasts[Math.floor(Math.random() * toasts.length)];
            speak(`–í–æ—Ç —Ö–æ—Ä–æ—à–∏–π —Ç–æ—Å—Ç: ${randomToast}`);
        }
        
        function readPoem() {
            const randomPoem = poems[Math.floor(Math.random() * poems.length)];
            speak(`–í–æ—Ç —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ: ${randomPoem}`);
        }
        
        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.lang = 'ru-RU';
                recognition.interimResults = true;
                recognition.continuous = true;
                recognition.maxAlternatives = 5;
                
                if (noiseSuppressionEnabled) {
                    recognition.continuous = false;
                    recognition.interimResults = false;
                }
                
                recognition.onstart = () => {
                    isListening = true;
                    micBtn.classList.add('active');
                    waves.style.display = 'flex';
                    animateWaves();
                };
                
                recognition.onresult = (event) => {
                    let finalTranscript = '';
                    let interimTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    
                    if (finalTranscript) {
                        finalTranscript = finalTranscript.trim();
                        
                        if (finalTranscript.toLowerCase().includes('–ª–∞–π—Ç')) {
                            activateLightMode();
                            return;
                        }
                        
                        if (isLightModeActive) {
                            processLightCommand(finalTranscript);
                        } else {
                            addMessage('user', finalTranscript);
                            processUserInput(finalTranscript);
                        }
                    }
                };
                
                recognition.onerror = (event) => {
                    console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:', event.error);
                    if (event.error !== 'no-speech') {
                        addMessage('assistant', '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ä–µ—á—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.', false);
                    }
                    resetVoiceRecognition();
                };
                
                recognition.onend = () => {
                    if (isLightModeActive && !isListening) {
                        recognition.start();
                    }
                    resetVoiceRecognition();
                };
            } else {
                addMessage('assistant', '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome –∏–ª–∏ Edge.', true);
                micBtn.disabled = true;
            }
        }
        
        function activateLightMode() {
            isLightModeActive = true;
            speak('–ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º "–ª–∞–π—Ç" –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –ì–æ–≤–æ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∏—Ç—Å—è.');
            
            clearTimeout(lightModeTimeout);
            lightModeTimeout = setTimeout(() => {
                isLightModeActive = false;
                speak('–ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º "–ª–∞–π—Ç" –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω.');
            }, 2000);
        }
        
        function processLightCommand(command) {
            command = command.toLowerCase();
            
            if (command.includes('—Å—Ç–æ–ø') || command.includes('–≤—ã—Ö–æ–¥')) {
                isLightModeActive = false;
                speak('–ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º "–ª–∞–π—Ç" –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.');
                return;
            }
            
            if (command.includes('–≤–≤–µ—Ä—Ö')) {
                moveMouse('up');
            } else if (command.includes('–≤–Ω–∏–∑')) {
                moveMouse('down');
            } else if (command.includes('–≤–ª–µ–≤–æ')) {
                moveMouse('left');
            } else if (command.includes('–≤–ø—Ä–∞–≤–æ')) {
                moveMouse('right');
            } else if (command.includes('–∫–ª–∏–∫') || command.includes('–Ω–∞–∂–º–∏')) {
                simulateMouseClick(mouseX, mouseY);
            } else if (command.includes('–æ—Ç–º–µ–Ω–∞') || command.includes('–æ—Ç–º–µ–Ω–∏—Ç—å')) {
                stopMouseControl();
            } else if (command.includes('–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã')) {
                speak('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã: –≤—Å–µ –∫–ª–∞–≤–∏—à–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ.');
            } else if (command.includes('—Å–æ–Ω') || command.includes('—Å–ø—è—â–∏–π —Ä–µ–∂–∏–º')) {
                speak('–ü–µ—Ä–µ–≤–æ–∂—É —Å–∏—Å—Ç–µ–º—É –≤ —Å–ø—è—â–∏–π —Ä–µ–∂–∏–º.');
            } else if (command.includes('–≤—ã–∫–ª—é—á–∏—Ç—å') || command.includes('–≤—ã–∫–ª—é—á–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä')) {
                speak('–í—ã–∫–ª—é—á–∞—é –∫–æ–º–ø—å—é—Ç–µ—Ä.');
            } else if (command.includes('–∑–∞–ø—É—Å—Ç–∏ –∏–≥—Ä—É') || command.includes('–∏–≥—Ä–∞—Ç—å')) {
                openEntertainmentExplorer();
                speak('–û—Ç–∫—Ä—ã–≤–∞—é –º–µ–Ω—é –∏–≥—Ä. –í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞.');
            } else if (command.includes('–∑–∞–ø—É—Å—Ç–∏ –¥–∏–Ω–æ–∑–∞–≤—Ä–∏–∫–∞') || command.includes('–¥–∏–Ω–æ–∑–∞–≤—Ä–∏–∫')) {
                startOfflineGame();
                speak('–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–î–∏–Ω–æ–∑–∞–≤—Ä–∏–∫". –ù–∞–∂–º–∏—Ç–µ –ø—Ä–æ–±–µ–ª, —á—Ç–æ–±—ã –ø—Ä—ã–≥–∞—Ç—å!');
            } else if (command.includes('–∑–∞–ø—É—Å—Ç–∏ –∑–º–µ–π–∫—É') || command.includes('–∑–º–µ–π–∫–∞')) {
                startSnakeGame();
                speak('–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–ó–º–µ–π–∫–∞". –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.');
            } else if (command.includes('–∑–∞–ø—É—Å—Ç–∏ —Ç–µ—Ç—Ä–∏—Å') || command.includes('—Ç–µ—Ç—Ä–∏—Å')) {
                startTetrisGame();
                speak('–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–¢–µ—Ç—Ä–∏—Å". –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–µ–ª–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.');
            } else if (command.includes('–µ—â–µ —Ä–∞–∑') || command.includes('–ø–æ–≤—Ç–æ—Ä–∏') || command.includes('—Å–Ω–æ–≤–∞')) {
                if (offlineGame.style.display === 'flex') {
                    startOfflineGame();
                    speak('–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–î–∏–Ω–æ–∑–∞–≤—Ä–∏–∫" —Å–Ω–æ–≤–∞.');
                } else if (snakeGame.style.display === 'flex') {
                    startSnakeGame();
                    speak('–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–ó–º–µ–π–∫–∞" —Å–Ω–æ–≤–∞.');
                } else if (tetrisGame.style.display === 'flex') {
                    startTetrisGame();
                    speak('–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É "–¢–µ—Ç—Ä–∏—Å" —Å–Ω–æ–≤–∞.');
                } else {
                    speak('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏–≥—Ä—É.');
                }
            } else if (command.includes('–∫–æ–º–∞–Ω–¥—ã') || command.includes('—Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥')) {
                speak('–í–æ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥: –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª—ã –∏–ª–∏ –ø–∞–ø–∫–∏, –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–º–µ—Ç–∫–∏, –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à–∫–æ–π, –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É, –ï—â–µ —Ä–∞–∑, –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã, –ù–æ–≤—ã–π —á–∞—Ç, –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç');
            } else {
                processUserInput(command);
            }
            
            clearTimeout(lightModeTimeout);
            lightModeTimeout = setTimeout(() => {
                isLightModeActive = false;
                speak('–ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º "–ª–∞–π—Ç" –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω.');
            }, 2000);
        }
        
        function simulateMouseClick(x, y) {
            mouseClickEffect.style.left = `${x - 15}px`;
            mouseClickEffect.style.top = `${y - 15}px`;
            mouseClickEffect.style.display = 'block';
            
            setTimeout(() => {
                mouseClickEffect.style.display = 'none';
            }, 500);
            
            const element = document.elementFromPoint(x, y);
            if (element) {
                element.click();
            }
        }
        
        function moveMouse(direction, amount = 10) {
            if (!mouseControlActive) {
                mouseControlActive = true;
                mousePointer.style.display = 'block';
                speak('–†–µ–∂–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º—ã—à–∫–æ–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –°–∫–∞–∂–∏—Ç–µ "–≤–ª–µ–≤–æ", "–≤–ø—Ä–∞–≤–æ", "–≤–≤–µ—Ä—Ö" –∏–ª–∏ "–≤–Ω–∏–∑" –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è. "–ö–ª–∏–∫" –¥–ª—è –Ω–∞–∂–∞—Ç–∏—è. "–û—Ç–º–µ–Ω–∞" –¥–ª—è –≤—ã—Ö–æ–¥–∞.');
                return;
            }
            
            switch(direction) {
                case 'left':
                    mouseX = Math.max(0, mouseX - amount);
                    break;
                case 'right':
                    mouseX = Math.min(window.innerWidth, mouseX + amount);
                    break;
                case 'up':
                    mouseY = Math.max(0, mouseY - amount);
                    break;
                case 'down':
                    mouseY = Math.min(window.innerHeight, mouseY + amount);
                    break;
            }
            
            mousePointer.style.left = `${mouseX - 10}px`;
            mousePointer.style.top = `${mouseY - 10}px`;
        }
        
        function stopMouseControl() {
            mouseControlActive = false;
            mousePointer.style.display = 'none';
            speak('–†–µ–∂–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º—ã—à–∫–æ–π –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.');
        }
        
        async function openSelectedFile() {
            if (!selectedFile) return;
            
            const handle = fileHandles.get(selectedFile.path);
            if (handle) {
                try {
                    const file = await handle.getFile();
                    addToRecentFiles(selectedFile);
                    
                    if (file.type.startsWith('text/') || file.type === 'application/json') {
                        const text = await file.text();
                        mainContent.innerHTML = `<pre>${text}</pre>`;
                        speak(`–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ "${selectedFile.name}": ${text.substring(0, 100)}...`);
                    } else if (file.type.startsWith('image/')) {
                        const fileURL = URL.createObjectURL(file);
                        mainContent.innerHTML = `<img src="${fileURL}" style="max-width:100%; max-height:400px;">`;
                        speak(`–û—Ç–∫—Ä—ã—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ "${selectedFile.name}".`);
                    } else if (file.type.startsWith('audio/')) {
                        const fileURL = URL.createObjectURL(file);
                        mainContent.innerHTML = `
                            <audio controls autoplay style="width:100%">
                                <source src="${fileURL}" type="${file.type}">
                            </audio>
                        `;
                        speak(`–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∞—É–¥–∏–æ —Ñ–∞–π–ª "${selectedFile.name}".`);
                    } else if (file.type.startsWith('video/')) {
                        const fileURL = URL.createObjectURL(file);
                        mainContent.innerHTML = `
                            <video controls autoplay style="max-width:100%; max-height:400px;">
                                <source src="${fileURL}" type="${file.type}">
                            </video>
                        `;
                        speak(`–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤–∏–¥–µ–æ —Ñ–∞–π–ª "${selectedFile.name}".`);
                    } else if (selectedFile.name.endsWith('.html') || selectedFile.name.endsWith('.htm')) {
                        const text = await file.text();
                        mainContent.innerHTML = text;
                        speak(`–û—Ç–∫—Ä—ã—Ç–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ "${selectedFile.name}".`);
                    } else {
                        const fileURL = URL.createObjectURL(file);
                        if (selectedFile.name.endsWith('.docx') || selectedFile.name.endsWith('.pptx')) {
                            window.open(`https://view.officeapps.live.com/op/view.aspx?src=${encodeURIComponent(fileURL)}`, '_blank');
                        } else if (selectedFile.name.endsWith('.exe')) {
                            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª? –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø–∞—Å–Ω–æ.')) {
                                window.open(fileURL, '_blank');
                            }
                        } else {
                            window.open(fileURL, '_blank');
                        }
                        speak(`–§–∞–π–ª "${selectedFile.name}" –æ—Ç–∫—Ä—ã—Ç –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ.`);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–∞:', error);
                    speak('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª.');
                }
            }
        }
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        function highlight() {
            dropZone.classList.add('highlight');
        }
        
        function unhighlight() {
            dropZone.classList.remove('highlight');
        }
        
        async function handleDrop(e) {
            const dt = e.dataTransfer;
            const items = [...dt.items];
            
            for (const item of items) {
                if (item.kind === 'file') {
                    try {
                        const handle = await item.getAsFileSystemHandle();
                        if (handle) {
                            fileHandles.set(handle.name, handle);
                            if (handle.kind === 'directory') {
                                await processDirectory(handle);
                            }
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞:', error);
                    }
                }
            }
            
            renderFileSystem();
            speak('–§–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã.');
        }
        
        async function processDirectory(directoryHandle, path = []) {
            for await (const entry of directoryHandle.values()) {
                const currentPath = [...path, directoryHandle.name].join('/');
                fileHandles.set(`${currentPath}/${entry.name}`, entry);
                if (entry.kind === 'directory') {
                    await processDirectory(entry, [...path, directoryHandle.name]);
                }
            }
        }
        
        function toggleVoiceRecognition() {
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }
        
        function resetVoiceRecognition() {
            isListening = false;
            micBtn.classList.remove('active');
            waves.style.display = 'none';
        }
        
        function animateWaves() {
            if (isListening) {
                const waveElements = document.querySelectorAll('.wave');
                waveElements.forEach(wave => {
                    const randomHeight = Math.floor(Math.random() * 25) + 5;
                    wave.style.height = `${randomHeight}px`;
                });
                requestAnimationFrame(animateWaves);
            }
        }
        
        function clearConversation() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –±–µ—Å–µ–¥—ã?')) {
                conversationHistory = [];
                chats[activeChatId].history = [];
                saveAllData();
                renderConversation();
                
                setTimeout(() => {
                    const welcomeMessage = '–ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à —É–º–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?';
                    addMessage('assistant', welcomeMessage, true);
                    speak(welcomeMessage);
                }, 500);
            }
        }
        
        function addMessage(sender, text, isInitial = false) {
            if (isInitial && conversationHistory.length > 0) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(`${sender}-message`);
            
            const formattedText = text.split('\n').map(paragraph => {
                return paragraph.trim() ? `<p>${paragraph}</p>` : '';
            }).join('');
            
            messageDiv.innerHTML = formattedText;
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            conversationHistory.push({
                sender: sender,
                text: text,
                timestamp: new Date().toISOString()
            });
            
            chats[activeChatId].history = conversationHistory;
            saveAllData();
        }
        
        function setupEventListeners() {
            micBtn.addEventListener('click', toggleVoiceRecognition);
            
            sendBtn.addEventListener('click', () => {
                if (textInput.value.trim()) {
                    processUserInput(textInput.value);
                    textInput.value = '';
                }
            });
            
            textInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && textInput.value.trim()) {
                    processUserInput(textInput.value);
                    textInput.value = '';
                }
            });
            
            clearBtn.addEventListener('click', clearConversation);
            
            backBtn.addEventListener('click', () => {
                window.location.href = '–§–∞–π–ª–æ–≤—ã–π –ø—Ä–æ–≤–æ–¥–Ω–∏–∫.html';
            });
            
            notesSaveBtn.addEventListener('click', saveNotes);
            
            openInExplorerBtn.addEventListener('click', async () => {
                if (selectedFile) {
                    await openSelectedFile();
                } else {
                    speak('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è.');
                }
            });
            
            deleteFileBtn.addEventListener('click', async () => {
                if (selectedFile) {
                    if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${selectedFile.name}"?`)) {
                        const handle = fileHandles.get(selectedFile.path);
                        if (handle) {
                            try {
                                await handle.remove();
                                fileHandles.delete(selectedFile.path);
                                speak(`–§–∞–π–ª "${selectedFile.name}" —É–¥–∞–ª–µ–Ω.`);
                                selectedFile = null;
                                filePreview.classList.remove('active');
                                renderFileSystem();
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                                speak('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª.');
                            }
                        }
                    }
                } else {
                    speak('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.');
                }
            });
            
            renameFileBtn.addEventListener('click', async () => {
                if (selectedFile) {
                    const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è:', selectedFile.name);
                    if (newName && newName !== selectedFile.name) {
                        const handle = fileHandles.get(selectedFile.path);
                        if (handle) {
                            try {
                                await handle.move(newName);
                                fileHandles.delete(selectedFile.path);
                                selectedFile.name = newName;
                                selectedFile.path = selectedFile.path.split('/').slice(0, -1).concat(newName).join('/');
                                fileHandles.set(selectedFile.path, handle);
                                speak(`–§–∞–π–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ "${newName}".`);
                                renderFileSystem();
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞:', error);
                                speak('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª.');
                            }
                        }
                    }
                } else {
                    speak('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è.');
                }
            });
            
            browseFilesBtn.addEventListener('click', async () => {
                try {
                    const dirHandle = await window.showDirectoryPicker();
                    await processDirectory(dirHandle);
                    renderFileSystem();
                    speak('–§–∞–π–ª—ã –∏ –ø–∞–ø–∫–∏ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–∑ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–∞.');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≤—ã–±–æ—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:', error);
                }
            });
            
            refreshFilesBtn.addEventListener('click', () => {
                renderFileSystem();
                speak('–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω.');
            });
            
            guessMelodyBtn.addEventListener('click', playGuessMelody);
            fortuneBtn.addEventListener('click', tellFortune);
            toastBtn.addEventListener('click', tellToast);
            poemBtn.addEventListener('click', readPoem);
            saveSettingsBtn.addEventListener('click', saveSettings);
            newChatBtn.addEventListener('click', createNewChat);
            dinoGameBtn.addEventListener('click', startOfflineGame);
            snakeGameBtn.addEventListener('click', startSnakeGame);
            tetrisGameBtn.addEventListener('click', startTetrisGame);
            backToMenuBtn.addEventListener('click', () => {
                offlineGame.style.display = 'none';
                isGameRunning = false;
                clearInterval(obstacleInterval);
            });
            playAgainBtn.addEventListener('click', () => {
                startOfflineGame();
            });
            backToMenuBtnSnake.addEventListener('click', () => {
                snakeGame.style.display = 'none';
                isGameRunning = false;
                clearInterval(snakeGameInterval);
            });
            playAgainBtnSnake.addEventListener('click', () => {
                startSnakeGame();
            });
            backToMenuBtnTetris.addEventListener('click', () => {
                tetrisGame.style.display = 'none';
                isGameRunning = false;
                clearInterval(tetrisGameInterval);
            });
            playAgainBtnTetris.addEventListener('click', () => {
                startTetrisGame();
            });
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            dropZone.addEventListener('drop', handleDrop, false);
            
            noiseSuppressionControl.addEventListener('change', () => {
                noiseSuppressionEnabled = noiseSuppressionControl.checked;
                updateNoiseSuppressionIndicator();
            });
            
            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
                
                if (mouseControlActive) {
                    mousePointer.style.left = `${mouseX - 10}px`;
                    mousePointer.style.top = `${mouseY - 10}px`;
                }
            });
        }
        
        window.addEventListener('load', () => {
            speechSynthesis.onvoiceschanged = initApp;
            if (speechSynthesis.getVoices().length > 0) {
                initApp();
            }
        });
    </script>
</body>
</html>
